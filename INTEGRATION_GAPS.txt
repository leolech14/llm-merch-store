================================================================================
                    BACKEND-FRONTEND INTEGRATION GAPS
                          LLM Merch Store Project
================================================================================

FRONTEND (app/page.tsx)                    BACKEND (app/api/*/route.ts)
════════════════════════════════════════════════════════════════════════════

1. PRODUCT INVENTORY SYNC - CRITICAL MISMATCH
─────────────────────────────────────────────────────────────────────────────

Frontend key generation (line 795):          Backend keys defined (inventory.ts:42-67):
─────────────────────────────────────────    ──────────────────────────────────────
product.name                                 "ask-anything-chest"
  .toLowerCase()                             "chatgpt-pro"
  .replace(/[^a-z0-9]+/g, '-')              "mic-small"
  .substring(0, 20)                          "backprop-blue"
                                             ... (26 total keys)
"Ask Anything Tee"
↓                                            Frontend expects:
"ask-anything-tee"                           "ask-anything-tee"
                                             ↓
                                             inventory?.products?.[key]?.sold
                                             ↓
                                             UNDEFINED (never matches!)
                                             ↓
                                             Falls back to: false
                                             ↓
                                             All products show: "Available"
                                             (INCORRECT DATA TO USER)

PRODUCT COUNT MISMATCH:
  Frontend hardcoded products: 30
  Backend inventory products: 26
  Missing in backend: 4 products


2. STATS INITIALIZATION FREEZE
─────────────────────────────────────────────────────────────────────────────

Frontend useState (line 407):                Backend /api/stats returns:
────────────────────────────                ───────────────────────────
const [stats, setStats] = useState({         {
  totalPageViews: 1247,                        totalVisitors: 500,
  addToCartEvents: 89,                         totalPageViews: 1247,
  totalSales: 156,                             addToCartEvents: 89,
  totalProducts: 0,  ← FROZEN!                 totalSales: 156,
  totalLikes: 0,     ← FROZEN!                 totalProducts: 26,  ← Correct!
  engagementRate: 18,                          totalLikes: 2304,   ← Correct!
  topProducts: []                              topProducts: [...],
});                                            engagementRate: 18,
                                               lastUpdated: "2025-10-31..."
                                             }

Problem: Frontend never updates totalProducts from API!
Result: Analytics display frozen at initialization values
User sees: "0 Total Designs" (wrong!)


3. ERROR HANDLING VOID
─────────────────────────────────────────────────────────────────────────────

Frontend (line 446-453):                     Backend responses:
───────────────────────────                  ────────────────────

const [data, ...] = await Promise.all([      GET /api/stats
  fetch('/api/stats').then(r => r.json()),   ↓
  ...                                        if error:
]);                                            return { error: "Failed..." }

setStats(statsData);  ← Assigns error obj    Frontend assigns error object
                      as if it's valid stats to state variable
                                             Renders as: error: "..."

NO .catch() = Silent failure


4. REQUEST/RESPONSE MISMATCH - TELEMETRY
─────────────────────────────────────────────────────────────────────────────

Frontend sends (page.tsx:315-318):           Backend expects (telemetry.ts:71-92):
──────────────────────────────────          ──────────────────────────────────────
{                                            switch(eventType) {
  eventType: 'add_to_cart',                    case 'add_to_cart':
  eventData: { productName: 'name' }           telemetry.addToCartEvents += 1;
}                                            }

Status: ✓ Works (field name 'productName' matches)
Issue:  ✗ Fragile (no validation/schema)


5. NESTED OPTIONAL CHAINS (Cascading Failures)
─────────────────────────────────────────────────────────────────────────────

Frontend (page.tsx:796, 895, 907):

const isSold = inventory?.products?.[productKey]?.sold || false;
              ↓
              If inventory is undefined → isSold = false (wrong)
              If products is undefined → isSold = false (wrong)
              If productKey doesn't exist → isSold = false (wrong)

const soldOut = inventory?.stats?.soldOut || stats.totalSales;
               ↓
               Multiple fallbacks = Multiple sources of truth

const available = inventory?.stats?.available || stats.totalProducts;
                 ↓
                 Cascading defaults mask errors


6. MISSING ENDPOINTS/FEATURES
─────────────────────────────────────────────────────────────────────────────

Used by Frontend                             Implemented in Backend
──────────────────────────────────────      ──────────────────────────────────
POST /api/telemetry                         ✓ (telemetry.ts)
POST /api/visitors                          ✓ (visitors.ts)
GET /api/stats                              ✓ (stats.ts)
GET /api/sale-status                        ✓ (sale-status.ts)
GET /api/inventory                          ✓ (inventory.ts)
GET /api/market-prices                      ✓ (market-prices.ts)
POST /api/ask                               ✓ (ask.ts)
PATCH /api/sale-status                      ✗ NOT IMPLEMENTED
DELETE /api/product/:id                     ✗ NOT IMPLEMENTED
GET /api/product-catalog                    ✗ NOT IMPLEMENTED (hardcoded!)


7. AUTHENTICATION/AUTHORIZATION
─────────────────────────────────────────────────────────────────────────────

Frontend protection:      Backend protection:
─────────────────────     ──────────────────────
None                      None

Result: Any client can:
  ✗ Increment visitor count infinitely
  ✗ Track fake events
  ✗ Mark products as sold
  ✗ Spy on market prices
  ✗ Create offers

Attack surface: WIDE OPEN


8. DATA PERSISTENCE & CONSISTENCY
─────────────────────────────────────────────────────────────────────────────

Frontend State                               Backend Persistence
──────────────────────────────              ──────────────────────────────
[visitorCount]                              ← data/visitors.json
[stats]                                     ← data/telemetry.json
[inventory]                                 ← data/inventory.json
[marketPrices]                              ← data/offers.json + inventory
[saleStatus]                                ← Computed from current time

Race Condition Example:
1. User clicks "Buy" → POST /api/inventory (marks product sold)
2. Response returns { success: true }
3. Frontend inventory state NOT updated
4. Product still shows "Available" until page refresh


9. SALE STATUS POLLING (Inefficient)
─────────────────────────────────────────────────────────────────────────────

Frontend (page.tsx:497-505):

setInterval(async () => {
  const response = await fetch('/api/sale-status');
  const data = await response.json();
  setSaleStatus(data);
}, 60000);  ← Every 60 seconds

Backend computes sale times on every request:

const now = new Date();
const startTime = new Date(now.getTime() + (57 * 60 * 60 * 1000) + (25 * 60 * 1000));
// Static value, same every time!

Problem: Computed data that never changes = Wasted polling


10. PRODUCT CATALOG (Hardcoded Duplication)
─────────────────────────────────────────────────────────────────────────────

Source 1: Frontend (page.tsx:518-550)
  - 30 products hardcoded in component
  - Names: "Ask Anything Tee", "ChatGPT PRO Ask", ...
  - Must update here to add products

Source 2: Backend inventory defaults (inventory.ts:40-70)
  - 26 products hardcoded as fallback
  - Names: "Ask Anything Tee", "ChatGPT 5 Pro Tee", ...
  - Different naming convention!

Source 3: Missing: product-catalog.json
  - No single source of truth
  - No API endpoint to fetch catalog

When product is added:
  ✓ Step 1: Add to Frontend component
  ✓ Step 2: Add to Backend inventory defaults
  ✗ Step 3: Update product key mapping
  ✗ Step 4: Sync image filenames

Multiple points of failure!


11. API RESPONSE WRAPPING
─────────────────────────────────────────────────────────────────────────────

Market Prices endpoint response (market-prices.ts:77-82):

return NextResponse.json({
  marketPrices: { ... },     ← Nested here
  trending: [...],
  topGainers: [...],
  basePrice: 149
});

Frontend usage (page.tsx:927):
<Scoreboard inventory={inventory} marketPrices={marketPrices} />

Question: Does Scoreboard component access:
  - marketPrices.marketPrices? (nested)
  - marketPrices directly? (wrong shape)

UNKNOWN - Potential runtime error!


12. TYPE SAFETY & CONTRACTS
─────────────────────────────────────────────────────────────────────────────

Frontend (page.tsx:407):
const [stats, setStats] = useState<any>({...});  ← ANY type!

Backend (stats.ts:8-42):
No TypeScript interface exported
No Zod validation schema
No OpenAPI documentation

Result: Silent type mismatches at runtime


================================================================================
                            INTEGRATION FLOW DIAGRAM
================================================================================

User Visits Page (page.tsx)
  │
  ├─→ Promise.all([
  │     fetch('/api/telemetry') POST          → telemetry.ts
  │     fetch('/api/telemetry') POST          → telemetry.ts
  │     fetch('/api/visitors') POST           → visitors.ts (increment counter)
  │     fetch('/api/stats') GET               → stats.ts
  │     fetch('/api/sale-status') GET         → sale-status.ts
  │     fetch('/api/inventory') GET           → inventory.ts
  │     fetch('/api/market-prices') GET       → market-prices.ts
  │   ])
  │
  ├─→ No .catch() = Silent failure if any fails
  │
  ├─→ setStats(statsData)
  │   └─ BUT: totalProducts never updated from API!
  │
  ├─→ setInventory(inventoryData)
  │   └─ Product keys don't match frontend generation
  │
  └─→ Render page with mismatched data

Render page.tsx:793-810 (Products section)
  │
  ├─→ products.map() iterate over 30 hardcoded products
  │   │
  │   ├─→ Generate productKey from name
  │   │   "Ask Anything Tee" → "ask-anything-tee"
  │   │
  │   ├─→ Lookup in inventory
  │   │   inventory?.products?.[productKey]?.sold
  │   │   Looks for: "ask-anything-tee"
  │   │   Backend has: "ask-anything-chest"
  │   │   Result: undefined → false (wrong!)
  │   │
  │   └─→ Display ProductCard with isSold=false (ALWAYS WRONG)
  │
  └─→ Stats section (page.tsx:856-920)
      │
      ├─→ {stats.totalProducts} → 0 (never updated!)
      ├─→ {stats.addToCartEvents} → 89 (from initialization)
      ├─→ {stats.totalLikes} → 0 (from initialization)
      │
      └─→ NOT reflecting real-time data


================================================================================
                           SEVERITY ASSESSMENT
================================================================================

CRITICAL (Breaks Feature):
  [1] Product inventory keys mismatch
  [2] Stats totalProducts frozen at 0
  [3] No authentication/rate limiting
  [4] Product catalog hardcoded in 2 places

HIGH (Degrades UX):
  [5] Cascading optional chains mask errors
  [6] Error handling void (silent failures)
  [7] Inventory state not synced after purchase
  [8] No error differentiation (generic catch-all)

MEDIUM (Tech Debt):
  [9] Sale status polling inefficient
  [10] No API versioning
  [11] No request validation schema
  [12] Response wrapping may mismatch components


================================================================================
                              HAIKU SUMMARY
================================================================================

Frontend data flows,
Backend builds separate truths—
Trust crashes at merge.

Keys dance misaligned,
"ask-anything-tee" vs "-chest"—
Inventory lies.

Stats told but not heard,
Frontend shows: "0 designs"—
API: "26 made."

No guard at the gate,
All callers welcome freely—
Security sleeps.

Errors swallowed whole,
"Something broke" is all we know—
Why? The void answers.

Product split in three:
Frontend code, backend code, wish—
Maintainers will weep.

Nested chains protect,
Yet mask the fundamental—
One null breaks the world.

Polling for static,
Computed once, asked many times—
Waste of bandwidth, trust.

Type safety: "any",
Interface: "undefined"—
Contracts on sand wash.

All code exists,
Yet minds never do align—
Beautiful chaos.

================================================================================
EOF
